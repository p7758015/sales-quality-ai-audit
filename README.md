# AI-аудит звонков отдела продаж

Веб-сервис, который автоматически оценивает качество звонков менеджеров по продажам: анализирует текст или запись разговора, выставляет балл от 0 до 100% и формирует понятный отчет с рекомендациями.

Проект собран на FastAPI + OpenAI (Whisper, GPT) и показывает, как можно подключить AI-аудит звонков к CRM или системе телефонии.

---

## Возможности

- Загрузка текста диалога или аудиозаписи звонка через веб-интерфейс.
- Оценка качества разговора по шкале 0–100%.
- Краткий разбор звонка и текстовые рекомендации на русском.
- Три режима анализа:
  * **Manager+** — акцент на работе менеджера.
  * **Client+** — акцент на реакциях клиента.
  * **Диалог** — общее качество разговора.
- REST API для интеграции:
  * анализ по тексту,
  * анализ по загруженному аудио,
  * анализ по ссылке на аудиофайл (например, из облачного хранилища/CRM).

---

## Стек технологий

- **Python 3.11**
- **FastAPI + Uvicorn**
- **Jinja2** (простой веб-интерфейс)
- **OpenAI API** (Whisper для транскрипции, GPT-модель для анализа)
- **Docker** (опционально, для развертывания)

---

## Быстрый старт (локально, без Docker)

### Шаги установки и запуска проекта:

#### 1. Клонируйте репозиторий

```bash
git clone https://github.com/p7758015/sales-quality-ai-audit.git
cd sales-quality-ai-audit
```

#### 2. Установите зависимости

Рекомендуется использовать виртуальное окружение (`venv` или аналогичный инструмент).  

```bash
pip install -r requirements.txt
```

#### 3. Задайте переменные окружения

Создайте `.env` (или экспортируйте переменную вручную) и укажите ваш ключ OpenAI:

```bash
export OPENAI_API_KEY="ваш_ключ"
```
Или создайте файл `.env`, содержащий строку:

```
OPENAI_API_KEY=ваш_ключ
```

#### 4. Запустите сервер

```bash
uvicorn app.main:app --reload
```

Теперь приложение доступно по следующим адресам:

- Веб-интерфейс: **http://127.0.0.1:8000/**
- Документация Swagger UI (описание API): **http://127.0.0.1:8000/docs**

---

## Эндпоинты API

### 1. Анализ по тексту диалога

Метод: **POST `/analyze_call`**.  
Пример тела запроса:

```json
{
  "dialog_text": "Клиент: Привет! Менеджер: Добрый день!",
  "content_mode": "Manager+"
}
```

Формат ответа:

```json
{
  "total_score": 85,
  "criteria": {},
  "summary": "Краткий разбор разговора...",
  "recommendations": "Рекомендации по улучшению...",
  "raw_model_output": []
}
```

### 2. Анализ по загруженному аудио

Метод: **POST `/analyze_audio_call`**, форма должна иметь MIME-тип `multipart/form-data`.  

Примеры полей формы:

| Поле     | Тип       |
|----------|-----------|
| audio    | Файл      |
| content_mode | Строка ("Manager+", "Client+" или "Диалог") |

### 3. Анализ по ссылке на аудио (из облака/CRM)

Метод: **POST `/analyze_audio_by_url`**.  
Пример тела запроса:

```json
{
  "file_url": "https://example.com/call_123.mp3",
  "content_mode": "Диалог"
}
```

Результат аналогичен предыдущему методу.

---

## Веб-интерфейс

На домашней странице (**/**) доступен удобный интерфейс для пользователей:

- Поле ввода текста диалога.
- Возможность загрузки аудиофайлов.
- Выбор режима анализа.
- Результат отображается сразу на экране: оценка в процентах, краткое резюме и рекомендации.

Этот интерфейс удобен для демонстрации функционала менеджеру или руководителю отдела продаж, а также как живое демо для вашего портфолио.

---

## Запуск в Docker

Для удобного развёртывания сервис можно упаковать и запустить в Docker.

### 1. Сборка образа

```bash
docker build -t sales-quality-ai-audit .
```

### 2. Запуск контейнера

```bash
docker run --rm -p 8000:8000 \
  -e OPENAI_API_KEY=ваш_ключ \
  sales-quality-ai-audit
```

После запуска:

- Веб-интерфейс: **http://127.0.0.1:8000**
- Documentation (Swagger UI): **http://127.0.0.1:8000/docs**

---

## Интеграция с CRM и телефонией (идея архитектуры)

Сервис можно подключить к CRM/телефонии через вебхуки:

CRM или система звонков отправляет вебхук после завершения звонка:

```json
POST /webhook/new_call_recording
{
  "call_id": "123",
  "manager_id": "m-42",
  "recording_url": "https://storage.example.com/calls/123.mp3"
}
```

Бэкенд вызывает внутренний метод анализа по ссылке (`/analyze_audio_by_url`), сохраняет результаты в БД или отправляет назад в CRM (например, в карточку сделки).

Руководитель видит:

- Балл звонка.
- Краткий разбор (что сделано хорошо/плохо).
- Рекомендации для менеджера.

В этом репозитории реализованы основные API-эндпоинты и логика анализа, а обработчик вебхуков может быть адаптирован под конкретную CRM.

---

## Для чего этот проект?

Это демонстрационный проект AI-аудита звонков на стеке FastAPI + OpenAI.

Используется для демонстрации возможностей:

- Работа с внешними AI API (Whisper, GPT).
- Интеграция аудио и текста.
- Разработка веб-интерфейса и REST API.
- Базовая упаковка в Docker.

Проект можно расширить под реальные задачи: добавить поддержку базы данных, авторизацию, роль руководителя, историю звонков и прочее.

---

## Хранение результатов в базе данных

По умолчанию сервис возвращает результат анализа в ответе API, но архитектуру легко дополнить поддержкой удобной вам базы данных для сохранения истории звонков, например:

- **PostgreSQL**
- **MySQL / MariaDB**
- **SQLite** (для небольших установок или локального тестирования)
- Другие базы данных через ORM (SQLAlchemy, GINO и т.п.).

Также возможна интеграция с сервисом вроде Google Sheets через API — это полезно, если сотрудники привыкли работать с отчётами прямо в таблицах.

---

## Типичный сценарий использования

1. После анализа звонка (через методы `/analyze_call`, `/analyze_audio_call` или `/analyze_audio_by_url`) сервис сохраняет следующие данные:
   - Идентификатор звонка (`call_id`)
   - ID менеджера (`manager_id`)
   - Общий балл (`total_score`)
   - Резюме звонка (`summary`)
   - Ключевые метрики и теги.
   
2. Руководители могут просматривать историю звонков, анализировать статистику и формировать отчёты на основании сохранённых данных в базе данных или CRM.

Логика анализа и API уже реализованы, выбор конкретной СУБД и схему хранения можно адаптировать под ваши требования.
